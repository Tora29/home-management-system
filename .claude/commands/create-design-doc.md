# 設計書生成コマンド

## 基本指示

指定されたファイルの内容を分析し、包括的な設計書を生成する。

引数の処理:

- 第1引数: file_path (必須) - 設計書を作成する対象ファイルのパス
- 第2引数: test_file_path (任意) - 対応するテストファイルのパス
- 第3引数: output_format (任意) - 出力形式 (adoc|md) デフォルト: adoc

## 実行手順

1. 引数で指定されたファイルの存在を確認する
2. テストファイルが指定されている場合は、その存在も確認する
3. ファイルの内容を読み込み、ファイルタイプを判定する
4. テストファイルが存在する場合は、テストケースを解析して仕様を抽出する
5. ファイルの内容とテスト仕様を分析し、設計書のテンプレートに沿って内容を整理する
6. 生成された設計書を `./docs/server-actions-docs/` ディレクトリに保存する
   - ファイル名: `[元ファイル名]-design.[拡張子]`
7. ユーザーに生成結果を報告する

## 設計書テンプレート

設計書には以下の項目を含める：

### 1. 概要

- ドキュメント/コードの目的
- 対象読者
- スコープと範囲

### 2. 背景と動機

- なぜこのドキュメント/コードが必要か
- 解決しようとしている問題
- ビジネス要件や技術的要件

### 3. アーキテクチャ/構造

- 全体的な構成
- 主要なコンポーネント/セクション
- 依存関係とその理由

### 4. 詳細設計

- 各コンポーネント/セクションの詳細
- インターフェース/API仕様
- データフローと処理フロー
- 状態管理

### 5. 実装ガイドライン

- ベストプラクティス
- 制約事項と前提条件
- 注意点とアンチパターン

### 6. 実装詳細

- アルゴリズムとロジック
- エラーハンドリング戦略
- リトライとフォールバック機構

### 7. 使用例

- 典型的な使用パターン
- サンプルコード/設定
- ユースケース

### 8. テスト仕様と検証

- 実際のテストケースから抽出した仕様
- テストシナリオとその意図
- カバレッジと品質基準
- 境界値テストとエッジケース

### 9. デプロイメントと運用

- デプロイ手順
- 環境設定の要件
- モニタリングとログ戦略

### 10. メンテナンス

- トラブルシューティングガイド
- よくある問題と解決策
- デバッグ手法

### 11. セキュリティ考慮事項

- 認証・認可の仕組み
- データ保護とプライバシー
- 潜在的な脆弱性と対策

### 12. パフォーマンス考慮事項

- パフォーマンス要件
- 最適化ポイント
- スケーラビリティ設計

### 13. 参考資料

- 関連ドキュメント
- 外部リソース

## ファイルタイプ別の考慮事項

### AsciiDoc/Markdown ドキュメント

- 既存の構造を尊重し、不足している部分を補完
- コード例の妥当性を確認
- 参照リンクの有効性をチェック

### TypeScript/JavaScript コード

- 型定義とインターフェースを詳細に記載
- 依存関係とインポートの整理
- React/Next.jsの場合はコンポーネント構造も記載
- テストファイルがある場合は、テストから実際の振る舞いと期待値を抽出

### 設定ファイル

- 各設定項目の意味と影響範囲
- デフォルト値と推奨値
- 環境別の設定差異

## テストファイル解析の詳細

テストファイルが提供された場合、以下を抽出して設計書に反映：

### テストケースからの仕様抽出

- `describe`/`it`/`test`ブロックから機能要件を理解
- アサーション（expect）から期待される動作を把握
- モックやスタブから外部依存関係を識別

### テストパターンの分析

- ユニットテスト: 個別機能の詳細仕様
- 統合テスト: コンポーネント間の連携仕様
- E2Eテスト: ユーザーシナリオと業務フロー

### テストデータの活用

- テストケースで使用されるデータから、入力値の妥当性を判断
- エッジケースや異常系のテストから、エラーハンドリングの仕様を抽出

## 出力形式

### AsciiDoc形式 (adoc)

```asciidoc
= [ドキュメント名] 設計書
:toc: left
:toclevels: 3
:sectnums:

== 概要
...
```

### Markdown形式 (md)

```markdown
# [ドキュメント名] 設計書

## 目次

...

## 概要

...
```

## エラーハンドリング

- ファイルが存在しない場合: エラーメッセージを表示して終了
- ファイルが読み取れない場合: アクセス権限を確認するよう促す
- 出力ディレクトリが作成できない場合: 権限エラーを表示

## 注意事項

1. コードベースの規約に従って設計書を作成する
2. 既存のドキュメントとの一貫性を保つ
3. 技術的な正確性を重視する
4. 読みやすく、理解しやすい構成にする
5. 必要に応じてユーザーと対話的に内容を確認する
