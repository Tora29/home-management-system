---
allowed-tools: Read, Glob, Grep, Bash(git status:*), Bash(git diff:*), Bash(git log:*)
description: "コンテキスト限界時に次回セッションへ引き継ぐプロンプトを作成します"
---

以下の手順で次回セッション引き継ぎ用のプロンプトを作成します:

## 実行フロー

1. **セッション履歴から情報を自動抽出**
   このセッション中のやり取りを分析して、以下を自動で読み取る：

   【自動抽出項目】
   - **タスク概要**: ユーザーの最初のリクエストや、セッション中で明示されたゴール
   - **完了した作業**: 実際に行った変更、作成・編集したファイル、解決した問題
   - **残りの作業**: TODOリストの未完了項目、会話中で「次は〜」「後で〜」と言及されたこと
   - **設計判断**: 「〜にしました」「〜を採用」など、重要な決定事項
   - **発生した問題**: エラー、ブロッカー、未解決の課題
   - **注意点**: 警告、制約、気をつけるべきこと

2. **現在のgit状態を自動収集**
   - `git status` で変更ファイル一覧を取得
   - `git diff --staged` でステージ済みの変更を確認
   - `git diff` で未ステージの変更を確認
   - 直近のコミット履歴を確認（関連があれば）

3. **収集した情報を整理**
   - セッション履歴から抽出した内容
   - 変更されたファイル一覧
   - 変更の概要（自動生成）
   - TODOリストの状態（存在する場合）

4. **引き継ぎプロンプトを生成して表示**

5. **ユーザーに確認**
   - 生成したプロンプトを表示
   - 追加・修正があれば反映

## 引き継ぎプロンプトテンプレート

```markdown
# セッション引き継ぎプロンプト

## タスク概要

[ユーザーからの入力に基づいて記載]

## 完了した作業

[ユーザーからの入力 + 自動検出した変更に基づいて記載]

### 変更されたファイル

- `path/to/file1.ts` - [変更内容の要約]
- `path/to/file2.svelte` - [変更内容の要約]
  ...

## 残りの作業

[ユーザーからの入力に基づいてチェックリスト形式で記載]

- [ ] タスク1
- [ ] タスク2
- [ ] タスク3

## 現在の状態

[gitの状態、ステージング状況など]

## 重要な情報

### 設計判断・決定事項

[ユーザーからの入力があれば記載]

### 注意点

[ユーザーからの入力があれば記載]

### 参照すべきファイル・ドキュメント

[ユーザーからの入力 + 関連ファイルを記載]

## 次のアクション

[次回セッションで最初に行うべきことを明確に記載]

---

作成日時: [現在の日時]
```

## 実行指示

1. **セッション履歴を分析** (ユーザーへの問いかけ不要で即座に実行)

   このセッションの会話履歴を読み取り、以下を抽出：
   - ユーザーが最初に依頼したこと → タスク概要
   - Claudeが実行したツール呼び出し（Edit, Write, Bash等）→ 完了した作業
   - TODOリストの状態 → 残りの作業
   - 「〜にしました」「〜を選択」等の発言 → 設計判断
   - エラーメッセージや「問題が〜」等の発言 → 発生した問題

2. **git状態を自動収集**

   ```bash
   # 変更ファイル一覧
   git status --porcelain

   # ステージ済みの変更
   git diff --staged --stat

   # 未ステージの変更
   git diff --stat

   # 直近のコミット（参考用）
   git log --oneline -5
   ```

3. **情報を整理してプロンプトを生成**
   - セッション履歴から抽出した情報を統合
   - テンプレートに沿ってMarkdown形式で出力
   - 変更ファイルには簡単な説明を付与（可能な範囲で）

4. **生成したプロンプトを表示**
   - コードブロック内に出力（コピーしやすいように）
   - 必要に応じて補足説明を追加

5. **ユーザーに確認を求める**

   ```
   上記の引き継ぎプロンプトを生成しました！

   【確認してください】
   - 追加したい情報はありますか？
   - 修正が必要な箇所はありますか？
   - 特に強調しておきたいポイントはありますか？

   問題なければ、上記をコピーして次回セッションで使用してください。
   ```

## 注意事項

1. **セキュリティ**
   - 機密情報（APIキー、パスワードなど）が含まれていないか確認
   - 含まれている場合は警告を表示

2. **コンテキストの優先度**
   - 残りの作業は具体的かつ実行可能な形で記載
   - 次回セッションで迷わないよう、最初のアクションを明確に

3. **自動検出の限界**
   - 変更内容の要約は推測に基づく場合がある旨を注記
   - ユーザーに確認・修正を促す
